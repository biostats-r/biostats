<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Enough targets to Write a Thesis - 3&nbsp; Getting started with targets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-output.html" rel="next">
<link href="./02-abstraction.html" rel="prev">
<link href="./../figures/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-workflow.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with targets</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Enough targets to Write a Thesis</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/biostats-r/biostats" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Before you start</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-abstraction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Functions and abstraction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-workflow.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with targets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Output files</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introduction-to-targets" id="toc-introduction-to-targets" class="nav-link active" data-scroll-target="#introduction-to-targets"><span class="header-section-number">3.1</span> Introduction to targets</a></li>
  <li>
<a href="#the-targets-pipeline" id="toc-the-targets-pipeline" class="nav-link" data-scroll-target="#the-targets-pipeline"><span class="header-section-number">3.2</span> The targets pipeline</a>
  <ul class="collapse">
<li><a href="#the-file-structure" id="toc-the-file-structure" class="nav-link" data-scroll-target="#the-file-structure"><span class="header-section-number">3.2.1</span> The file structure</a></li>
  <li><a href="#the-_target.r-file" id="toc-the-_target.r-file" class="nav-link" data-scroll-target="#the-_target.r-file"><span class="header-section-number">3.2.2</span> The _target.R file</a></li>
  <li><a href="#populate-the-_target.r-file" id="toc-populate-the-_target.r-file" class="nav-link" data-scroll-target="#populate-the-_target.r-file"><span class="header-section-number">3.2.3</span> Populate the _target.R file</a></li>
  <li><a href="#run-the-pipeline" id="toc-run-the-pipeline" class="nav-link" data-scroll-target="#run-the-pipeline"><span class="header-section-number">3.2.4</span> Run the pipeline</a></li>
  <li><a href="#load-targets" id="toc-load-targets" class="nav-link" data-scroll-target="#load-targets"><span class="header-section-number">3.2.5</span> Load targets</a></li>
  </ul>
</li>
  <li>
<a href="#trouble-shooting" id="toc-trouble-shooting" class="nav-link" data-scroll-target="#trouble-shooting"><span class="header-section-number">3.3</span> Trouble shooting</a>
  <ul class="collapse">
<li><a href="#locate-problem" id="toc-locate-problem" class="nav-link" data-scroll-target="#locate-problem"><span class="header-section-number">3.3.1</span> Locate problem</a></li>
  <li><a href="#object-not-found" id="toc-object-not-found" class="nav-link" data-scroll-target="#object-not-found"><span class="header-section-number">3.3.2</span> Object not found</a></li>
  <li><a href="#duplicate-target" id="toc-duplicate-target" class="nav-link" data-scroll-target="#duplicate-target"><span class="header-section-number">3.3.3</span> Duplicate target</a></li>
  </ul>
</li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">3.4</span> Resources</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with targets</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
In this chapter, you will
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>learn the basic targets workflow</li>
<li>build your own targets pipeline</li>
</ul>
</div>
</div>
<section id="introduction-to-targets" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="introduction-to-targets">
<span class="header-section-number">3.1</span> Introduction to targets</h2>
<p>Targets is a <strong>pipeline tool</strong>, which coordinates the different steps in data science in R. It manages the workflow, takes care of dependencies in the code and keeps track of outdated objects. Targets takes care of the cash.</p>
<p>A targets <strong>pipeline</strong> consists of different steps, such as importing data, running an analysis or making a figure (<a href="#fig-targets-pipeline">Figure&nbsp;<span>3.1</span></a>) (1). Each step in the pipeline is a <strong>target</strong> and can for example be a data frame, a model or a figure. A target is basically an R object and is created by a <strong>function</strong>. A pipeline has a main script that puts all the pieces of code together and takes care of dependencies and keeping track of changes.</p>
<p>This concept should sound familiar to you after reading the previous chapter on abstraction.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definitions
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>
<strong>pipeline tool</strong> - coordinates different steps of data science</li>
<li>
<strong>target</strong> - an R object in memory</li>
<li>
<strong>function</strong> - self contained code that accomplish a specific task</li>
</ul>
</div>
</div>
<p>When updating and rerunning one part of the code, targets will skip parts where the upstream code has not changed and are therefore still up to date (<a href="#fig-targets-pipeline">Figure&nbsp;<span>3.1</span></a>) (2). Targets will only rerun the code that is outdated and ensures that your results always match the underlying code and maintains a <strong>reproducible workflow</strong> (3). It avoids unnecessary repetition and can saves costly running time.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-targets-pipeline" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/reproducible_pipeline.png" class="img-fluid figure-img" alt="Reproducible targets pipeline." width="421"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Reproducible targets pipeline.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
When is targets useful?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>When the code has a long runtime because it is slow or complex. Targets avoids running code that up to date and allows for parallel processing.</p></li>
<li><p>When the workflow has interconnected tasks with dependencies</p></li>
</ul>
</div>
</div>
</section><section id="the-targets-pipeline" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="the-targets-pipeline">
<span class="header-section-number">3.2</span> The targets pipeline</h2>
<section id="the-file-structure" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="the-file-structure">
<span class="header-section-number">3.2.1</span> The file structure</h3>
<p>A target workflow has a specific file structure including R code, functions, qmd files, data and a <code>_targets.R</code> file (<a href="#fig-file-structure">Figure&nbsp;<span>3.2</span></a>). The <code>_targets.R</code> file is mandatory and the most important file defining the targets pipeline. This file lives at the root of the R project folder.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-file-structure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/file_structure.png" class="img-fluid figure-img" alt="The file structure of an R Studio project with a target pipeline." width="383"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: File structure of an R Studio project with a target pipeline.</figcaption></figure>
</div>
</div>
</div>
<p>An R project has many other files and it is recommended to keep code and data files in separate folders to keep the repository tidy. It is common to have one or several scripts that contain custom user-defined functions. These scripts should be stored in one folder. In this example we will call the folder <code>R</code>: <code>R/functions.R</code>.</p>
<p>To set up this file structure in an RStudio project, use the <code><a href="https://docs.ropensci.org/targets/reference/use_targets.html">use_targets()</a></code> function, which creates an initial <code>_targets.R</code> script with comments to help you populate the script. Note that it also creates a couple of other files, one of which is called <code>run.R</code>. This is a helper script to run the pipeline and will be explained later.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Go to the targets-workflow-svalbard Rstudio project and load the targets library <code><a href="https://docs.ropensci.org/targets/">library(targets)</a></code>. Then start to set up a targets pipeline by using the <code><a href="https://docs.ropensci.org/targets/reference/use_targets.html">use_targets()</a></code> function.</p>
</div>
</div>
</section><section id="the-_target.r-file" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="the-_target.r-file">
<span class="header-section-number">3.2.2</span> The _target.R file</h3>
<p>The <code>_targets.R</code> file is the <strong>main script</strong> and configures and defines the pipeline. This file is mandatory and without it the targets pipeline will not work. When using the <code><a href="https://docs.ropensci.org/targets/reference/use_targets.html">use_targets()</a></code> function, it sets up the basic structure and comments to help fill out the rest (see below ðŸ‘‡) .</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Created by use_targets().</span></span>
<span><span class="co"># Follow the comments below to fill in this target script.</span></span>
<span><span class="co"># Then follow the manual to check and run the pipeline:</span></span>
<span><span class="co">#   https://books.ropensci.org/targets/walkthrough.html#inspect-the-pipeline</span></span>
<span></span>
<span><span class="co"># Load packages required to define the pipeline:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/">targets</a></span><span class="op">)</span></span>
<span><span class="co"># library(tarchetypes) # Load other packages as needed.</span></span>
<span></span>
<span><span class="co"># Set target options:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tibble"</span><span class="op">)</span> <span class="co"># packages that your targets need to run</span></span>
<span>  <span class="co"># format = "qs", # Optionally set the default storage format. qs is fast.</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># For distributed computing in tar_make(), supply a {crew} controller</span></span>
<span>  <span class="co"># as discussed at https://books.ropensci.org/targets/crew.html.</span></span>
<span>  <span class="co"># Choose a controller that suits your needs. For example, the following</span></span>
<span>  <span class="co"># sets a controller with 2 workers which will run as local R processes:</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#   controller = crew::crew_controller_local(workers = 2)</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># Alternatively, if you want workers to run on a high-performance computing</span></span>
<span>  <span class="co"># cluster, select a controller from the {crew.cluster} package. The following</span></span>
<span>  <span class="co"># example is a controller for Sun Grid Engine (SGE).</span></span>
<span>  <span class="co"># </span></span>
<span>  <span class="co">#   controller = crew.cluster::crew_controller_sge(</span></span>
<span>  <span class="co">#     workers = 50,</span></span>
<span>  <span class="co">#     # Many clusters install R as an environment module, and you can load it</span></span>
<span>  <span class="co">#     # with the script_lines argument. To select a specific verison of R,</span></span>
<span>  <span class="co">#     # you may need to include a version string, e.g. "module load R/4.3.0".</span></span>
<span>  <span class="co">#     # Check with your system administrator if you are unsure.</span></span>
<span>  <span class="co">#     script_lines = "module load R"</span></span>
<span>  <span class="co">#   )</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># Set other options as needed.</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tar_make_clustermq() is an older (pre-{crew}) way to do distributed computing</span></span>
<span><span class="co"># in {targets}, and its configuration for your machine is below.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>clustermq.scheduler <span class="op">=</span> <span class="st">"multicore"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tar_make_future() is an older (pre-{crew}) way to do distributed computing</span></span>
<span><span class="co"># in {targets}, and its configuration for your machine is below.</span></span>
<span><span class="co"># Install packages {{future}}, {{future.callr}}, and {{future.batchtools}} to allow use_targets() to configure tar_make_future() options.</span></span>
<span></span>
<span><span class="co"># Run the R scripts in the R/ folder with your custom functions:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_source.html">tar_source</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># source("other_functions.R") # Source other scripts as needed.</span></span>
<span></span>
<span><span class="co"># Replace the target list below with your own:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">data</span>,</span>
<span>    command <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># format = "feather" # efficient storage for large data frames</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">model</span>,</span>
<span>    command <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coefficients</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Open the <code>_targets.R</code> in your repo and have a look at your <code>_targets.R</code> file.</p>
</div>
</div>
<p>The <code>_targets.R</code> file has three main components. Note that the file also contains other options which are optional. We will discuss the three main component step-by-step.</p>
<ol type="1">
<li>
<code><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set()</a></code> <strong>sets all options</strong> such as load necessary packages or defining the output format. The argument <code>package</code> should have a list of all the required packages that are needed to run the pipeline. Note that <code>targets</code> needs to be loaded first and outside this function, otherwise the pipeline will not work.</li>
</ol>
<p>The <code>tarchetypes</code> package contains helper functions and needs to be loaded if your pipeline contains a quarto file (see next chapter). Packages that are only used in a quarto file can be loaded directly in there and do not need to be loaded in the <code>_targets.R</code> file.</p>
<p>The argument <code>format</code> letâ€™s you define default storage format.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load packages required to define the pipeline:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/">targets</a></span><span class="op">)</span></span>
<span><span class="co"># library(tarchetypes) # Load other packages as needed.</span></span>
<span></span>
<span><span class="co"># Set target options:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tibble"</span><span class="op">)</span>, <span class="co"># packages that your targets need to run</span></span>
<span>  format <span class="op">=</span> <span class="st">"rds"</span> <span class="co"># default storage format</span></span>
<span>  <span class="co"># Set other options as needed.</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>The function <code><a href="https://docs.ropensci.org/targets/reference/tar_source.html">tar_source()</a></code> will <strong>source all the R scripts</strong> in the <code>R/</code> folder.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Run the R scripts in the R/ folder with your custom functions:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_source.html">tar_source</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>The last section makes <strong>a list of targets</strong> which is the pipeline. Each target is a step in the pipeline, for example importing data, run an analysis or make a figure and looks like a normal R object (e.g.&nbsp;tibble, vector, figure). Each target is declared by the <code><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target()</a></code> function and separated by a comma. The <code><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target()</a></code> needs two arguments: <code>name</code> defines the target name and <code>command</code> the code to produce the target. Usually the command is calling a custom function.</li>
</ol>
<p>Here is a target that uses the function <code>fit_model()</code> that was created in the previous chapter to run a linear regression.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit model for plant height</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">model</span>,</span>
<span>             command <span class="op">=</span> <span class="fu">fit_model</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each target should have a unique name that can be called downstream in the pipeline. The order of the targets does not matter. The pipeline will figure out which targets depends on each other and run them in the right order.</p>
<p>Once the pipeline has run, the targets are stored.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Targets names
</div>
</div>
<div class="callout-body-container callout-body">
<p>Targets names must be unique (no duplicates), should not start with a dot and the name should be meaningful (do not use my_variable).</p>
</div>
</div>
<p><strong>Data files</strong> are special targets, because they also need the argument <code>format</code> to declare that this target is a file. Each time the pipeline is run, targetes will check if the file has been changed and if this is the case automatically import the data again the next time the pipeline is run.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">file</span>,</span>
<span>             command <span class="op">=</span> <span class="st">"data/PFTC4_Svalbard_2018_Gradient_Traits.csv"</span>,</span>
<span>             format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How many targets should I make?
</div>
</div>
<div class="callout-body-container callout-body">
<p>A target should do one thing only (e.g.&nbsp;make a figure) and if a functions gets too long, it can be split into nested sub-functions to make the code readable and easier to maintain. Keep the number of targets manageable, which means keep a balance between the amount of code that goes in one target and the number of targets.</p>
</div>
</div>
</section><section id="populate-the-_target.r-file" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="populate-the-_target.r-file">
<span class="header-section-number">3.2.3</span> Populate the _target.R file</h3>
<p>Now we can populate the <code>_targets.R</code> file. We need to set the options, source the custom functions, and define the pipeline.</p>
<p>First, we need to add all R packages to the <code><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set()</a></code> function in the <code>_targets.R</code> file that are needed to run the pipeline.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Add all the necessary R packages in <code><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set()</a></code> in the <code>_targets.R</code> file that are needed to run the pipeline.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Set target options:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span> <span class="co"># packages that your targets need to run</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>The next step is to source all the functions. The <code><a href="https://docs.ropensci.org/targets/reference/tar_source.html">tar_source()</a></code> function in the <code>_targets.R</code> file already does this. But we are missing one last function to make the figure.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write a function that makes a figure showing leaf area in both gradients.</p>
</div>
</div>
<p>The last step is to set up the targets pipeline.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Define the data file</strong></p>
<p>Add the dataset as data file in the <code>_targets.R</code> file.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">file</span>,</span>
<span>             command <span class="op">=</span> <span class="va">path</span>,</span>
<span>             format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Add other targets to the pipeline</strong></p>
<p>Add four more targets to the pipeline that</p>
<ul>
<li><p>import the data</p></li>
<li><p>clean the data</p></li>
<li><p>run a linear regression</p></li>
<li><p>and make a figure</p></li>
</ul>
<p>The last three targets are calling custom functions from the <code>functions.R</code> file. The targets are separated by a comma.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># data file</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">file</span>,</span>
<span>             command <span class="op">=</span> <span class="va">path</span>,</span>
<span>             format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># import data</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">target1</span>,</span>
<span>             command <span class="op">=</span> <span class="va">function1</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># clean data</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">target2</span>,</span>
<span>             command <span class="op">=</span> <span class="va">function2</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">...</span></span>
<span>  </span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Well done, you have just set up your first target pipeline. Have a treat ðŸ¥•!</p>
</section><section id="run-the-pipeline" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="run-the-pipeline">
<span class="header-section-number">3.2.4</span> Run the pipeline</h3>
<p>Now we are ready to run the pipeline. For this open the <code>run.R</code> script and run the <code><a href="https://docs.ropensci.org/targets/reference/tar_make.html">tar_make()</a></code> function. This function looks for the <code>_targets.R</code> in the working directory and runs the pipeline.</p>
<p>When running the pipeline for the first time you will see a list of all the targets that are built (<a href="#fig-run-pipeline">Figure&nbsp;<span>3.3</span></a>). This is indicated by start target and build target.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-run-pipeline" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/pipeline.png" class="img-fluid figure-img" alt="R output after running the pipeline for the first time." width="361"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: R output after running the pipeline for the first time.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Open the <code>run.R</code> script and run the pipeline. Hopefully, everything will run smoothly ðŸ¤ž! If not check out the Trouble shooting section below.</p>
</div>
</div>
<p>Well done you have run your first targets pipeline. The <code><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork()</a></code> function shows the dependency graph of the pipeline and is a nice way of vizualizing the pipeline. Circles are targets, triangles functions, and the colour indicates if the targets are up to date or not.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-vizualise" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/viz_workflow.png" class="img-fluid figure-img" alt="Dependency graph that vizualises the target pipeline." width="528"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: Vizualise the targets pipeline.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Run <code><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork()</a></code> to visualize your pipeline.</p>
</div>
</div>
<p>Once the pipeline has run, it will always skip the targets that have not changed and are up to date and only run the once that need updating. In the long run this will save a lot of computational time and is one of the big advantages of using targets pipelines.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-run-pipeline2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/pipeline2.png" class="img-fluid figure-img" alt="R output after running the pipeline." width="331"></p>
<figcaption class="figure-caption">Figure&nbsp;3.5: R output after running the pipeline.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Change something in your pipeline. For example filter for a different species: bistorta vivipara. Save the script and run <code><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork()</a></code> to visualize which object are not up to date now.</p>
<p>Rerun the pipeline using <code><a href="https://docs.ropensci.org/targets/reference/tar_make.html">tar_make()</a></code>.</p>
<p>And run <code><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork()</a></code> again to check if everything is up to date again.</p>
</div>
</div>
</section><section id="load-targets" class="level3" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="load-targets">
<span class="header-section-number">3.2.5</span> Load targets</h3>
<p>Each target can be loaded using <code><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load()</a></code> and the pipeline does not need rerunning each time before accessing the targets. This is a huge advantage of the targets pipeline and can save a lot of time.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To access all the targets at once use <code><a href="https://docs.ropensci.org/targets/reference/tar_load_everything.html">tar_load_everything()</a></code>. In <code><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load()</a></code> you can also use tidy select commands to load specific targets, e.g.&nbsp;<code>tar_load(starts_with("y"))</code></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load()</a></code> to load the target <em>traits</em>.</p>
<p>Run <code>str(traits)</code> to display the structure of the object traits.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Do it step-by-step
</div>
</div>
<div class="callout-body-container callout-body">
<p>Targets plans can become huge and complex. Start small, create a few targets and functions and make the plan running. Then add new code in small steps and check regularly if the plan is still working This will help to understand and solve errors (see trouble shooting section).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-complex-network" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/complex_network.png" class="img-fluid figure-img" alt="Dependency graph that vizualises a complex target pipeline." width="541"></p>
<figcaption class="figure-caption">Figure&nbsp;3.6: Vizualisation of complex target pipeline.</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
</section></section><section id="trouble-shooting" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="trouble-shooting">
<span class="header-section-number">3.3</span> Trouble shooting</h2>
<section id="locate-problem" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="locate-problem">
<span class="header-section-number">3.3.1</span> Locate problem</h3>
<p>Error messages in targets can be hard to understand and will look something like this:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-error" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/error.png" class="img-fluid figure-img" alt="Error in the pipeline." width="802"></p>
<figcaption class="figure-caption">Figure&nbsp;3.7: Error in the pipeline.</figcaption></figure>
</div>
</div>
</div>
<p>You can see that the pipeline broke when running the target <em>model</em>. To learn more about the problem run the command <code>targets::tar_meta(fields = error, complete_only = TRUE)</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-error2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/solve_error.png" class="img-fluid figure-img" alt="Find out more about a problem in the pipeline." width="459"></p>
<figcaption class="figure-caption">Figure&nbsp;3.8: Find out more about a problem in the pipeline.</figcaption></figure>
</div>
</div>
</div>
<p>The R output now gives some more information about the problem. Here the argument response is missing.</p>
<p>If an error is difficult to understand use <code><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load()</a></code> to load one specific target or <code><a href="https://docs.ropensci.org/targets/reference/tar_load_everything.html">tar_load_everything()</a></code> to load all targets. Then you can try to run different parts of the script to test where the code breaks.</p>
<p>Best practice is to run the pipeline regularly, which makes it easier locate where the error occurred.</p>
</section><section id="object-not-found" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="object-not-found">
<span class="header-section-number">3.3.2</span> Object not found</h3>
<p>A common error is to call a target that does not exist. When running the pipeline this error will appear (<a href="#fig-error-not-found">Figure&nbsp;<span>3.9</span></a>). This is usually if the name is spelled wrong or when using an old name.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-error-not-found" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/error_not_found.png" class="img-fluid figure-img" alt="Error message for missing object." width="546"></p>
<figcaption class="figure-caption">Figure&nbsp;3.9: Error message for missing object</figcaption></figure>
</div>
</div>
</div>
</section><section id="duplicate-target" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="duplicate-target">
<span class="header-section-number">3.3.3</span> Duplicate target</h3>
<p>Another common mistake is to use the same name for two different targets (<a href="#fig-error-duplicate">Figure&nbsp;<span>3.10</span></a>). This is common when copy pasting code. Rename one of the objects and the problem is solved.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-error-duplicate" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/error_duplicate.png" class="img-fluid figure-img" alt="Error message for duplicate target." width="579"></p>
<figcaption class="figure-caption">Figure&nbsp;3.10: Error message for duplicate target.</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="resources" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="resources">
<span class="header-section-number">3.4</span> Resources</h2>
<ul>
<li>The <a href="https://books.ropensci.org/targets/">target manual</a> contains everything you need to know <!-- did not find it on github -->
</li>
<li>Here is a large and working <a href="">target plan</a>
</li>
<li>A paper about pipelines: Brousil, M. R., Filazzola, A., Meyer, M. F., Sharma, S., &amp; Hampton, S. E. (2023). Improving ecological data science with workflow management software. Methods in Ecology and Evolution. <a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.14113?utm_source=pocket_saves">https://doi.org/10.1111/2041-210X.14113</a>
</li>
<li>Here is a short introduction video <div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://player.vimeo.com/video/700982360" frameborder="0" allow="autoplay; title=" fullscreen="" picture-in-picture="" allowfullscreen=""></iframe></div>
</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-abstraction.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Functions and abstraction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-output.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Output files</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: sentence</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Getting started with targets</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">## In this chapter, you will</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>learn the basic targets workflow</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>build your own targets pipeline</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to targets</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>Targets is a **pipeline tool**, which coordinates the different steps in data science in R.</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>It manages the workflow, takes care of dependencies in the code and keeps track of outdated objects.</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>Targets takes care of the cash.</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>A targets **pipeline** consists of different steps, such as importing data, running an analysis or making a figure (@fig-targets-pipeline) (1).</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>Each step in the pipeline is a **target** and can for example be a data frame, a model or a figure.</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>A target is basically an R object and is created by a **function**.</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>A pipeline has a main script that puts all the pieces of code together and takes care of dependencies and keeping track of changes.</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>This concept should sound familiar to you after reading the previous chapter on abstraction.</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Definitions</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**pipeline tool** - coordinates different steps of data science</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**target** - an R object in memory</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**function** - self contained code that accomplish a specific task</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>When updating and rerunning one part of the code, targets will skip parts where the upstream code has not changed and are therefore still up to date (@fig-targets-pipeline) (2).</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>Targets will only rerun the code that is outdated and ensures that your results always match the underlying code and maintains a  **reproducible workflow** (3). </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>It avoids unnecessary repetition and can saves costly running time.</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-targets-pipeline</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Reproducible targets pipeline.</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Reproducible targets pipeline.</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/reproducible_pipeline.png"</span>)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## When is targets useful?</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When the code has a long runtime because it is slow or complex. Targets avoids running code that up to date and allows for parallel processing.</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When the workflow has interconnected tasks with dependencies</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## The targets pipeline</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### The file structure</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>A target workflow has a specific file structure including R code, functions, qmd files, data and a <span class="in">`_targets.R`</span> file (@fig-file-structure).</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>The <span class="in">`_targets.R`</span> file is mandatory and the most important file defining the targets pipeline.</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>This file lives at the root of the R project folder.</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-file-structure</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: File structure of an R Studio project with a target pipeline.</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: The file structure of an R Studio project with a target pipeline.</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/file_structure.png"</span>)</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>An R project has many other files and it is recommended to keep code and data files in separate folders to keep the repository tidy.</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>It is common to have one or several scripts that contain custom user-defined functions.</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>These scripts should be stored in one folder. </span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>In this example we will call the folder <span class="in">`R`</span>: <span class="in">`R/functions.R`</span>.</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>To set up this file structure in an RStudio project, use the <span class="in">`use_targets()`</span> function, which creates an initial <span class="in">`_targets.R`</span> script with comments to help you populate the script.</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>Note that it also creates a couple of other files, one of which is called <span class="in">`run.R`</span>.</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>This is a helper script to run the pipeline and will be explained later.</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>Go to the targets-workflow-svalbard Rstudio project and load the targets library <span class="in">`library(targets)`</span>.</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>Then start to set up a targets pipeline by using the <span class="in">`use_targets()`</span> function.</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="fu">### The _target.R file</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>The <span class="in">`_targets.R`</span> file is the **main script** and configures and defines the pipeline.</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>This file is mandatory and without it the targets pipeline will not work.</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>When using the <span class="in">`use_targets()`</span> function, it sets up the basic structure and comments to help fill out the rest (see below ðŸ‘‡) .</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: target-file</span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Created by use_targets().</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Follow the comments below to fill in this target script.</span></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Then follow the manual to check and run the pipeline:</span></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   https://books.ropensci.org/targets/walkthrough.html#inspect-the-pipeline</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages required to define the pipeline:</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tarchetypes) # Load other packages as needed.</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Set target options:</span></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(</span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">"tibble"</span>) <span class="co"># packages that your targets need to run</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># format = "qs", # Optionally set the default storage format. qs is fast.</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For distributed computing in tar_make(), supply a {crew} controller</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as discussed at https://books.ropensci.org/targets/crew.html.</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Choose a controller that suits your needs. For example, the following</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sets a controller with 2 workers which will run as local R processes:</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   controller = crew::crew_controller_local(workers = 2)</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Alternatively, if you want workers to run on a high-performance computing</span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cluster, select a controller from the {crew.cluster} package. The following</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># example is a controller for Sun Grid Engine (SGE).</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   controller = crew.cluster::crew_controller_sge(</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     workers = 50,</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     # Many clusters install R as an environment module, and you can load it</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     # with the script_lines argument. To select a specific verison of R,</span></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     # you may need to include a version string, e.g. "module load R/4.3.0".</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     # Check with your system administrator if you are unsure.</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     script_lines = "module load R"</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   )</span></span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set other options as needed.</span></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a><span class="co"># tar_make_clustermq() is an older (pre-{crew}) way to do distributed computing</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a><span class="co"># in {targets}, and its configuration for your machine is below.</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">clustermq.scheduler =</span> <span class="st">"multicore"</span>)</span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a><span class="co"># tar_make_future() is an older (pre-{crew}) way to do distributed computing</span></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a><span class="co"># in {targets}, and its configuration for your machine is below.</span></span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages {{future}}, {{future.callr}}, and {{future.batchtools}} to allow use_targets() to configure tar_make_future() options.</span></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the R scripts in the R/ folder with your custom functions:</span></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_source</span>()</span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a><span class="co"># source("other_functions.R") # Source other scripts as needed.</span></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the target list below with your own:</span></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> data,</span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">command =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>    <span class="co"># format = "feather" # efficient storage for large data frames</span></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> model,</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">command =</span> <span class="fu">coefficients</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data))</span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>Open the <span class="in">`_targets.R`</span> in your repo and have a look at your <span class="in">`_targets.R`</span> file.</span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>The <span class="in">`_targets.R`</span> file has three main components.</span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>Note that the file also contains other options which are optional.</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a>We will discuss the three main component step-by-step.</span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`tar_option_set()`</span> **sets all options** such as load necessary packages or defining the output format.</span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a>The argument <span class="in">`package`</span> should have a list of all the required packages that are needed to run the pipeline.</span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a>Note that <span class="in">`targets`</span> needs to be loaded first and outside this function, otherwise the pipeline will not work.</span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>The <span class="in">`tarchetypes`</span> package contains helper functions and needs to be loaded if your pipeline contains a quarto file (see next chapter).</span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>Packages that are only used in a quarto file can be loaded directly in there and do not need to be loaded in the <span class="in">`_targets.R`</span> file.</span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>The argument <span class="in">`format`</span> let's you define default storage format. </span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar-option</span></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages required to define the pipeline:</span></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tarchetypes) # Load other packages as needed.</span></span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Set target options:</span></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">"tibble"</span>), <span class="co"># packages that your targets need to run</span></span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"rds"</span> <span class="co"># default storage format</span></span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set other options as needed.</span></span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>The function <span class="in">`tar_source()`</span> will **source all the R scripts** in the <span class="in">`R/`</span> folder.</span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar-ssource</span></span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the R scripts in the R/ folder with your custom functions:</span></span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_source</span>()</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The last section makes **a list of targets** which is the pipeline.</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>Each target is a step in the pipeline, for example importing data, run an analysis or make a figure and looks like a normal R object (e.g. tibble, vector, figure).</span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>Each target is declared by the <span class="in">`tar_target()`</span> function and separated by a comma.</span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>The <span class="in">`tar_target()`</span> needs two arguments:</span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a><span class="in">`name`</span> defines the target name and <span class="in">`command`</span> the code to produce the target.</span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>Usually the command is calling a custom function.</span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>Here is a target that uses the function <span class="in">`fit_model()`</span> that was created in the previous chapter to run a linear regression.</span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: regression-target</span></span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model for plant height</span></span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> model,</span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> <span class="fu">fit_model</span>(data))</span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a>Each target should have a unique name that can be called downstream in the pipeline.</span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a>The order of the targets does not matter.</span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a>The pipeline will figure out which targets depends on each other and run them in the right order.</span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a>Once the pipeline has run, the targets are stored.</span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a><span class="fu">## Targets names</span></span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>Targets names must be unique (no duplicates), should not start with a dot and the name should be meaningful (do not use my_variable).</span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a>**Data files** are special targets, because they also need the argument <span class="in">`format`</span> to declare that this target is a file.</span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>Each time the pipeline is run, targetes will check if the file has been changed and if this is the case automatically import the data again the next time the pipeline is run.</span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-target</span></span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-281"><a href="#cb10-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-282"><a href="#cb10-282" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> file,</span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> <span class="st">"data/PFTC4_Svalbard_2018_Gradient_Traits.csv"</span>,</span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">"file"</span>)</span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a><span class="fu">## How many targets should I make?</span></span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a>A target should do one thing only (e.g. make a figure) and if a functions gets too long, it can be split into nested sub-functions to make the code readable and easier to maintain.</span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a>Keep the number of targets manageable, which means keep a balance between the amount of code that goes in one target and the number of targets.</span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a><span class="fu">### Populate the _target.R file</span></span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a>Now we can populate the <span class="in">`_targets.R`</span> file.</span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a>We need to set the options, source the custom functions, and define the pipeline.</span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a>First, we need to add all R packages to the <span class="in">`tar_option_set()`</span> function in the <span class="in">`_targets.R`</span> file that are needed to run the pipeline.</span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-304"><a href="#cb10-304" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-305"><a href="#cb10-305" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a>Add all the necessary R packages in <span class="in">`tar_option_set()`</span> in the <span class="in">`_targets.R`</span> file that are needed to run the pipeline.</span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar-option-example</span></span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a><span class="co"># Set target options:</span></span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(</span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>) <span class="co"># packages that your targets need to run</span></span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a>The next step is to source all the functions.</span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a>The <span class="in">`tar_source()`</span> function in the <span class="in">`_targets.R`</span> file already does this.</span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a>But we are missing one last function to make the figure.</span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a>Write a function that makes a figure showing leaf area in both gradients.</span>
<span id="cb10-333"><a href="#cb10-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-334"><a href="#cb10-334" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a>The last step is to set up the targets pipeline.</span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a>**Define the data file**</span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a>Add the dataset as data file in the <span class="in">`_targets.R`</span> file.</span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-target2</span></span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> file,</span>
<span id="cb10-356"><a href="#cb10-356" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> path,</span>
<span id="cb10-357"><a href="#cb10-357" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">"file"</span>)</span>
<span id="cb10-358"><a href="#cb10-358" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-359"><a href="#cb10-359" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-360"><a href="#cb10-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-362"><a href="#cb10-362" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-363"><a href="#cb10-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a>**Add other targets to the pipeline**</span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a>Add four more targets to the pipeline that</span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>import the data</span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>clean the data</span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>run a linear regression</span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>and make a figure</span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a>The last three targets are calling custom functions from the <span class="in">`functions.R`</span> file.</span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a>The targets are separated by a comma.</span>
<span id="cb10-382"><a href="#cb10-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-383"><a href="#cb10-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-384"><a href="#cb10-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-387"><a href="#cb10-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-388"><a href="#cb10-388" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pipeline</span></span>
<span id="cb10-389"><a href="#cb10-389" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-391"><a href="#cb10-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-392"><a href="#cb10-392" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data file</span></span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> file,</span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> path,</span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">"file"</span>),</span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a>  <span class="co"># import data</span></span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> target1,</span>
<span id="cb10-400"><a href="#cb10-400" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> function1),</span>
<span id="cb10-401"><a href="#cb10-401" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clean data</span></span>
<span id="cb10-403"><a href="#cb10-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> target2,</span>
<span id="cb10-404"><a href="#cb10-404" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> function2),</span>
<span id="cb10-405"><a href="#cb10-405" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-406"><a href="#cb10-406" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a>Well done, you have just set up your first target pipeline.</span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a>Have a treat ðŸ¥•!</span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-419"><a href="#cb10-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-420"><a href="#cb10-420" aria-hidden="true" tabindex="-1"></a><span class="fu">### Run the pipeline</span></span>
<span id="cb10-421"><a href="#cb10-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-422"><a href="#cb10-422" aria-hidden="true" tabindex="-1"></a>Now we are ready to run the pipeline.</span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a>For this open the <span class="in">`run.R`</span> script and run the <span class="in">`tar_make()`</span> function.</span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a>This function looks for the <span class="in">`_targets.R`</span> in the working directory and runs the pipeline.</span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a>When running the pipeline for the first time you will see a list of all the targets that are built (@fig-run-pipeline).</span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a>This is indicated by start target and build target.</span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-run-pipeline</span></span>
<span id="cb10-433"><a href="#cb10-433" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: R output after running the pipeline for the first time.</span></span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: R output after running the pipeline for the first time.</span></span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/pipeline.png"</span>)</span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-441"><a href="#cb10-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-442"><a href="#cb10-442" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a>Open the <span class="in">`run.R`</span> script and run the pipeline.</span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a>Hopefully, everything will run smoothly ðŸ¤ž!</span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a>If not check out the Trouble shooting section below.</span>
<span id="cb10-448"><a href="#cb10-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-449"><a href="#cb10-449" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-450"><a href="#cb10-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-451"><a href="#cb10-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-452"><a href="#cb10-452" aria-hidden="true" tabindex="-1"></a>Well done you have run your first targets pipeline.</span>
<span id="cb10-453"><a href="#cb10-453" aria-hidden="true" tabindex="-1"></a>The <span class="in">`tar_visnetwork()`</span> function shows the dependency graph of the pipeline and is a nice way of vizualizing the pipeline.</span>
<span id="cb10-454"><a href="#cb10-454" aria-hidden="true" tabindex="-1"></a>Circles are targets, triangles functions, and the colour indicates if the targets are up to date or not.</span>
<span id="cb10-455"><a href="#cb10-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-458"><a href="#cb10-458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-459"><a href="#cb10-459" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-vizualise</span></span>
<span id="cb10-460"><a href="#cb10-460" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-461"><a href="#cb10-461" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Vizualise the targets pipeline.</span></span>
<span id="cb10-462"><a href="#cb10-462" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Dependency graph that vizualises the target pipeline.</span></span>
<span id="cb10-463"><a href="#cb10-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-464"><a href="#cb10-464" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/viz_workflow.png"</span>)</span>
<span id="cb10-465"><a href="#cb10-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-466"><a href="#cb10-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-467"><a href="#cb10-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-468"><a href="#cb10-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-469"><a href="#cb10-469" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-470"><a href="#cb10-470" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-471"><a href="#cb10-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-472"><a href="#cb10-472" aria-hidden="true" tabindex="-1"></a>Run <span class="in">`tar_visnetwork()`</span> to visualize your pipeline.</span>
<span id="cb10-473"><a href="#cb10-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-474"><a href="#cb10-474" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-475"><a href="#cb10-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-476"><a href="#cb10-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-477"><a href="#cb10-477" aria-hidden="true" tabindex="-1"></a>Once the pipeline has run, it will always skip the targets that have not changed and are up to date and only run the once that need updating.</span>
<span id="cb10-478"><a href="#cb10-478" aria-hidden="true" tabindex="-1"></a>In the long run this will save a lot of computational time and is one of the big advantages of using targets pipelines.</span>
<span id="cb10-479"><a href="#cb10-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-480"><a href="#cb10-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-483"><a href="#cb10-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-484"><a href="#cb10-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-run-pipeline2</span></span>
<span id="cb10-485"><a href="#cb10-485" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-486"><a href="#cb10-486" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: R output after running the pipeline.</span></span>
<span id="cb10-487"><a href="#cb10-487" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: R output after running the pipeline.</span></span>
<span id="cb10-488"><a href="#cb10-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-489"><a href="#cb10-489" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/pipeline2.png"</span>)</span>
<span id="cb10-490"><a href="#cb10-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-491"><a href="#cb10-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-492"><a href="#cb10-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-493"><a href="#cb10-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-494"><a href="#cb10-494" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-495"><a href="#cb10-495" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-496"><a href="#cb10-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-497"><a href="#cb10-497" aria-hidden="true" tabindex="-1"></a>Change something in your pipeline.</span>
<span id="cb10-498"><a href="#cb10-498" aria-hidden="true" tabindex="-1"></a>For example filter for a different species: bistorta vivipara.</span>
<span id="cb10-499"><a href="#cb10-499" aria-hidden="true" tabindex="-1"></a>Save the script and run <span class="in">`tar_visnetwork()`</span> to visualize which object are not up to date now.</span>
<span id="cb10-500"><a href="#cb10-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-501"><a href="#cb10-501" aria-hidden="true" tabindex="-1"></a>Rerun the pipeline using <span class="in">`tar_make()`</span>.</span>
<span id="cb10-502"><a href="#cb10-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-503"><a href="#cb10-503" aria-hidden="true" tabindex="-1"></a>And run <span class="in">`tar_visnetwork()`</span> again to check if everything is up to date again.</span>
<span id="cb10-504"><a href="#cb10-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-505"><a href="#cb10-505" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-506"><a href="#cb10-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-507"><a href="#cb10-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-508"><a href="#cb10-508" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load targets</span></span>
<span id="cb10-509"><a href="#cb10-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-510"><a href="#cb10-510" aria-hidden="true" tabindex="-1"></a>Each target can be loaded using <span class="in">`tar_load()`</span> and the pipeline does not need rerunning each time before accessing the targets.</span>
<span id="cb10-511"><a href="#cb10-511" aria-hidden="true" tabindex="-1"></a>This is a huge advantage of the targets pipeline and can save a lot of time. </span>
<span id="cb10-512"><a href="#cb10-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-515"><a href="#cb10-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-516"><a href="#cb10-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-target</span></span>
<span id="cb10-517"><a href="#cb10-517" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb10-518"><a href="#cb10-518" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb10-519"><a href="#cb10-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-520"><a href="#cb10-520" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(model)</span>
<span id="cb10-521"><a href="#cb10-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-522"><a href="#cb10-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-523"><a href="#cb10-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-524"><a href="#cb10-524" aria-hidden="true" tabindex="-1"></a>To access all the targets at once use <span class="in">`tar_load_everything()`</span>.</span>
<span id="cb10-525"><a href="#cb10-525" aria-hidden="true" tabindex="-1"></a>In <span class="in">`tar_load()`</span> you can also use tidy select commands to load specific targets, e.g. <span class="in">`tar_load(starts_with("y"))`</span></span>
<span id="cb10-526"><a href="#cb10-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-527"><a href="#cb10-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-528"><a href="#cb10-528" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb10-529"><a href="#cb10-529" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb10-530"><a href="#cb10-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-531"><a href="#cb10-531" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`tar_load()`</span> to load the target *traits*.</span>
<span id="cb10-532"><a href="#cb10-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-533"><a href="#cb10-533" aria-hidden="true" tabindex="-1"></a>Run <span class="in">`str(traits)`</span> to display the structure of the object traits.</span>
<span id="cb10-534"><a href="#cb10-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-535"><a href="#cb10-535" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-536"><a href="#cb10-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-537"><a href="#cb10-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-538"><a href="#cb10-538" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb10-539"><a href="#cb10-539" aria-hidden="true" tabindex="-1"></a><span class="fu">## Do it step-by-step</span></span>
<span id="cb10-540"><a href="#cb10-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-541"><a href="#cb10-541" aria-hidden="true" tabindex="-1"></a>Targets plans can become huge and complex.</span>
<span id="cb10-542"><a href="#cb10-542" aria-hidden="true" tabindex="-1"></a>Start small, create a few targets and functions and make the plan running.</span>
<span id="cb10-543"><a href="#cb10-543" aria-hidden="true" tabindex="-1"></a>Then add new code in small steps and check regularly if the plan is still working</span>
<span id="cb10-544"><a href="#cb10-544" aria-hidden="true" tabindex="-1"></a>This will help to understand and solve errors (see trouble shooting section).</span>
<span id="cb10-545"><a href="#cb10-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-548"><a href="#cb10-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-549"><a href="#cb10-549" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-complex-network</span></span>
<span id="cb10-550"><a href="#cb10-550" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-551"><a href="#cb10-551" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Vizualisation of complex target pipeline.</span></span>
<span id="cb10-552"><a href="#cb10-552" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Dependency graph that vizualises a complex target pipeline.</span></span>
<span id="cb10-553"><a href="#cb10-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-554"><a href="#cb10-554" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/complex_network.png"</span>)</span>
<span id="cb10-555"><a href="#cb10-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-556"><a href="#cb10-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-557"><a href="#cb10-557" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-558"><a href="#cb10-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-559"><a href="#cb10-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-560"><a href="#cb10-560" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trouble shooting</span></span>
<span id="cb10-561"><a href="#cb10-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-562"><a href="#cb10-562" aria-hidden="true" tabindex="-1"></a><span class="fu">### Locate problem</span></span>
<span id="cb10-563"><a href="#cb10-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-564"><a href="#cb10-564" aria-hidden="true" tabindex="-1"></a>Error messages in targets can be hard to understand and will look something like this:</span>
<span id="cb10-565"><a href="#cb10-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-568"><a href="#cb10-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-569"><a href="#cb10-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-error</span></span>
<span id="cb10-570"><a href="#cb10-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-571"><a href="#cb10-571" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Error in the pipeline.</span></span>
<span id="cb10-572"><a href="#cb10-572" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Error in the pipeline.</span></span>
<span id="cb10-573"><a href="#cb10-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-574"><a href="#cb10-574" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/error.png"</span>)</span>
<span id="cb10-575"><a href="#cb10-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-576"><a href="#cb10-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-577"><a href="#cb10-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-578"><a href="#cb10-578" aria-hidden="true" tabindex="-1"></a>You can see that the pipeline broke when running the target *model*.</span>
<span id="cb10-579"><a href="#cb10-579" aria-hidden="true" tabindex="-1"></a>To learn more about the problem run the command <span class="in">`targets::tar_meta(fields = error, complete_only = TRUE)`</span>.</span>
<span id="cb10-580"><a href="#cb10-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-583"><a href="#cb10-583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-584"><a href="#cb10-584" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-error2</span></span>
<span id="cb10-585"><a href="#cb10-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-586"><a href="#cb10-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Find out more about a problem in the pipeline.</span></span>
<span id="cb10-587"><a href="#cb10-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Find out more about a problem in the pipeline.</span></span>
<span id="cb10-588"><a href="#cb10-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-589"><a href="#cb10-589" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/solve_error.png"</span>)</span>
<span id="cb10-590"><a href="#cb10-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-591"><a href="#cb10-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-592"><a href="#cb10-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-593"><a href="#cb10-593" aria-hidden="true" tabindex="-1"></a>The R output now gives some more information about the problem.</span>
<span id="cb10-594"><a href="#cb10-594" aria-hidden="true" tabindex="-1"></a>Here the argument response is missing.</span>
<span id="cb10-595"><a href="#cb10-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-596"><a href="#cb10-596" aria-hidden="true" tabindex="-1"></a>If an error is difficult to understand use <span class="in">`tar_load()`</span> to load one specific target or <span class="in">`tar_load_everything()`</span> to load all targets.</span>
<span id="cb10-597"><a href="#cb10-597" aria-hidden="true" tabindex="-1"></a>Then you can try to run different parts of the script to test where the code breaks.</span>
<span id="cb10-598"><a href="#cb10-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-599"><a href="#cb10-599" aria-hidden="true" tabindex="-1"></a>Best practice is to run the pipeline regularly, which makes it easier locate where the error occurred.</span>
<span id="cb10-600"><a href="#cb10-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-601"><a href="#cb10-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-602"><a href="#cb10-602" aria-hidden="true" tabindex="-1"></a><span class="fu">### Object not found</span></span>
<span id="cb10-603"><a href="#cb10-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-604"><a href="#cb10-604" aria-hidden="true" tabindex="-1"></a>A common error is to call a target that does not exist.</span>
<span id="cb10-605"><a href="#cb10-605" aria-hidden="true" tabindex="-1"></a>When running the pipeline this error will appear (@fig-error-not-found).</span>
<span id="cb10-606"><a href="#cb10-606" aria-hidden="true" tabindex="-1"></a>This is usually if the name is spelled wrong or when using an old name.</span>
<span id="cb10-607"><a href="#cb10-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-610"><a href="#cb10-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-611"><a href="#cb10-611" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-error-not-found</span></span>
<span id="cb10-612"><a href="#cb10-612" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-613"><a href="#cb10-613" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Error message for missing object</span></span>
<span id="cb10-614"><a href="#cb10-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Error message for missing object.</span></span>
<span id="cb10-615"><a href="#cb10-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-616"><a href="#cb10-616" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/error_not_found.png"</span>)</span>
<span id="cb10-617"><a href="#cb10-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-618"><a href="#cb10-618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-619"><a href="#cb10-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-620"><a href="#cb10-620" aria-hidden="true" tabindex="-1"></a><span class="fu">### Duplicate target</span></span>
<span id="cb10-621"><a href="#cb10-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-622"><a href="#cb10-622" aria-hidden="true" tabindex="-1"></a>Another common mistake is to use the same name for two different targets (@fig-error-duplicate).</span>
<span id="cb10-623"><a href="#cb10-623" aria-hidden="true" tabindex="-1"></a>This is common when copy pasting code.</span>
<span id="cb10-624"><a href="#cb10-624" aria-hidden="true" tabindex="-1"></a>Rename one of the objects and the problem is solved.</span>
<span id="cb10-625"><a href="#cb10-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-628"><a href="#cb10-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-629"><a href="#cb10-629" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-error-duplicate</span></span>
<span id="cb10-630"><a href="#cb10-630" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-631"><a href="#cb10-631" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Error message for duplicate target.</span></span>
<span id="cb10-632"><a href="#cb10-632" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Error message for duplicate target.</span></span>
<span id="cb10-633"><a href="#cb10-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-634"><a href="#cb10-634" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/error_duplicate.png"</span>)</span>
<span id="cb10-635"><a href="#cb10-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-636"><a href="#cb10-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-637"><a href="#cb10-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-638"><a href="#cb10-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-639"><a href="#cb10-639" aria-hidden="true" tabindex="-1"></a><span class="fu">## Resources</span></span>
<span id="cb10-640"><a href="#cb10-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-641"><a href="#cb10-641" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="co">[</span><span class="ot">target manual</span><span class="co">](https://books.ropensci.org/targets/)</span> contains everything you need to know</span>
<span id="cb10-642"><a href="#cb10-642" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- did not find it on github --&gt;</span></span>
<span id="cb10-643"><a href="#cb10-643" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here is a large and working <span class="co">[</span><span class="ot">target plan</span><span class="co">]()</span></span>
<span id="cb10-644"><a href="#cb10-644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A paper about pipelines: Brousil, M. R., Filazzola, A., Meyer, M. F., Sharma, S., &amp; Hampton, S. E. (2023). Improving ecological data science with workflow management software. Methods in Ecology and Evolution. <span class="co">[</span><span class="ot">https://doi.org/10.1111/2041-210X.14113</span><span class="co">](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.14113?utm_source=pocket_saves)</span></span>
<span id="cb10-645"><a href="#cb10-645" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here is a short introduction video {{&lt; video https://vimeo.com/700982360 &gt;}}</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>