<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 Working with single tables in dplyr | Working in R</title>
<meta name="author" content="Jonathan Soulé, Aud Halbritter and Richard J Telford">
<meta name="description" content="Data frames are usually the most convenient objects for storing, plotting or analysing data in R. We also need to be able to manipulate data in data frames. This tutorial will show you how to...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="7 Working with single tables in dplyr | Working in R">
<meta property="og:type" content="book">
<meta property="og:description" content="Data frames are usually the most convenient objects for storing, plotting or analysing data in R. We also need to be able to manipulate data in data frames. This tutorial will show you how to...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="7 Working with single tables in dplyr | Working in R">
<meta name="twitter:description" content="Data frames are usually the most convenient objects for storing, plotting or analysing data in R. We also need to be able to manipulate data in data frames. This tutorial will show you how to...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet">
<script src="libs/panelset-0.2.6/panelset.js"></script><link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style-chapters.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Working in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li class="book-part">Setting up R and RStudio</li>
<li><a class="" href="getting-started-with-r.html"><span class="header-section-number">2</span> Getting started with R</a></li>
<li class="book-part">First steps in R</li>
<li><a class="" href="first-steps-in-r.html"><span class="header-section-number">3</span> First steps in R</a></li>
<li><a class="" href="importing-data-in-r.html"><span class="header-section-number">4</span> Importing data in R</a></li>
<li class="book-part">Data manipulation with the tidyverse</li>
<li><a class="" href="pipes.html"><span class="header-section-number">5</span> Pipes</a></li>
<li><a class="" href="tidying-data-with-tidyr.html"><span class="header-section-number">6</span> Tidying data with tidyr</a></li>
<li><a class="active" href="working-with-single-tables-in-dplyr.html"><span class="header-section-number">7</span> Working with single tables in dplyr</a></li>
<li><a class="" href="working-with-multiple-tables-in-dplyr.html"><span class="header-section-number">8</span> Working with multiple tables in dplyr</a></li>
<li class="book-part">Data visualisation</li>
<li><a class="" href="why-is-data-visualization-important.html"><span class="header-section-number">10</span> Why is data visualization important?</a></li>
<li><a class="" href="getting-started-with-ggplot.html"><span class="header-section-number">11</span> Getting started with ggplot</a></li>
<li><a class="" href="types-of-vizualization.html"><span class="header-section-number">12</span> Types of vizualization</a></li>
<li><a class="" href="themes-1.html"><span class="header-section-number">13</span> Themes</a></li>
<li><a class="" href="shapes-colours-and-linetypes.html"><span class="header-section-number">14</span> Shapes, colours and linetypes</a></li>
<li><a class="" href="combining-plots.html"><span class="header-section-number">15</span> Combining plots</a></li>
<li class="book-part">Other topics</li>
<li><a class="" href="handling-missing-values.html"><span class="header-section-number">16</span> Handling missing values</a></li>
<li><a class="" href="bestiary-of-brackets-and-other-r-notation.html"><span class="header-section-number">17</span> Bestiary of Brackets and other R notation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="working-with-single-tables-in-dplyr" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Working with single tables in <code>dplyr</code><a class="anchor" aria-label="anchor" href="#working-with-single-tables-in-dplyr"><i class="fas fa-link"></i></a>
</h1>
<p>Data frames are usually the most convenient objects for storing, plotting or analysing data in R.
We also need to be able to manipulate data in data frames.</p>
<p>This tutorial will show you how to manipulate data frames using the <code>dplyr</code> package, part of <code>tidyverse</code>.</p>
<p>Everything that can be done with <code>dplyr</code> can be done with base R.
The <code>dplyr</code> solution is usually easier to write and understand, and can be faster.</p>
<p>There are many function in <code>dplyr</code>, this tutorial focuses on the functions I find most useful.</p>
<div id="load-the-package" class="section level3" number="7.0.1">
<h3>
<span class="header-section-number">7.0.1</span> Load the package<a class="anchor" aria-label="anchor" href="#load-the-package"><i class="fas fa-link"></i></a>
</h3>
<p>You can load <code>dplyr</code> with</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span></code></pre></div>
<p>But is is usually more convenient to load <code>tidyverse</code> so that you get <code>ggplot2</code>, <code>dplyr</code>, <code>readr</code> and other useful packages with one command.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="more-feedback-tidylog" class="section level3" number="7.0.2">
<h3>
<span class="header-section-number">7.0.2</span> More feedback <code>tidylog</code><a class="anchor" aria-label="anchor" href="#more-feedback-tidylog"><i class="fas fa-link"></i></a>
</h3>
<p>We can get more feedback on what <code>dplyr</code> functions have done to the data by loading the <code>tidylog</code> package.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/elbersb/tidylog/">"tidylog"</a></span><span class="op">)</span>
<span class="co"># if you are using conflicted, you will need to set conflict_prefer() for all dplyr function</span>
<span class="co"># use purrr::map to iterate over tidylog functions </span>
<span class="co"># library(conflicted)</span>
<span class="co"># map(getNamespaceExports("tidylog"), ~conflict_prefer(.x, winner = "tidylog"))</span></code></pre></div>
<p>More than once, <code>tidylog</code> has helped identified bugs in my code.</p>
</div>
<div id="the-penguins-dataset" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> The <code>penguins</code> dataset<a class="anchor" aria-label="anchor" href="#the-penguins-dataset"><i class="fas fa-link"></i></a>
</h2>
<p>This tutorial will use the <code>penguins</code> dataset from the <a href="https://github.com/allisonhorst/palmerpenguins"><code>palmerpenguins</code> package</a>.
This dataset includes measurements of three species of penguin.</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"penguins"</span>, package <span class="op">=</span> <span class="st">"palmerpenguins"</span><span class="op">)</span>
<span class="co"># Show the data</span>
<span class="va">penguins</span></code></pre></div>
<pre><code>## # A tibble: 344 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           39.1          18.7               181        3750 male  
## 2 Adelie  Torgersen           39.5          17.4               186        3800 female
## 3 Adelie  Torgersen           40.3          18                 195        3250 female
## # … with 341 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
</div>
<div id="selecting-columns-with-select" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Selecting columns with <code>select()</code><a class="anchor" aria-label="anchor" href="#selecting-columns-with-select"><i class="fas fa-link"></i></a>
</h2>
<p>You can choose which columns of the data frame you want with <code><a href="https://rdrr.io/pkg/tidylog/man/select.html">select()</a></code>.</p>
<p>The first argument is the data, which is supplied by the pipe <code>|&gt;</code>, the next arguments are the names of the columns you want.
The names do not need quote marks.</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#select species, bill_length_mm &amp; bill_depth_mm</span>
<span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span></code></pre></div>
<pre><code>## select: dropped 5 variables (island, flipper_length_mm, body_mass_g, sex, year)</code></pre>
<pre><code>## # A tibble: 344 × 3
##   species bill_length_mm bill_depth_mm
##   &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;
## 1 Adelie            39.1          18.7
## 2 Adelie            39.5          17.4
## 3 Adelie            40.3          18  
## # … with 341 more rows</code></pre>
<p>This is equivalent to the base R code</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#select species, bill_length_mm &amp; bill_depth_mm</span>
<span class="va">penguins</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"bill_length_mm"</span>, <span class="st">"bill_depth_mm"</span><span class="op">)</span><span class="op">]</span> </code></pre></div>
<pre><code>## # A tibble: 344 × 3
##   species bill_length_mm bill_depth_mm
##   &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;
## 1 Adelie            39.1          18.7
## 2 Adelie            39.5          17.4
## 3 Adelie            40.3          18  
## # … with 341 more rows</code></pre>
<p>Remember that if you want to use the output of this code in a further analysis, you need to assign it to an object name with <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code>.</p>
<div id="select-helpers" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> <code>select()</code> helpers<a class="anchor" aria-label="anchor" href="#select-helpers"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes we don’t want to write out the names of all the columns we want to select.
We might not even know them all in advance.
Fortunately there are some helper functions.</p>
<p>If you want to <code><a href="https://rdrr.io/pkg/tidylog/man/select.html">select()</a></code> adjacent columns, you can use the notation <code>first:last</code>.</p>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#select species to bill_depth_mm</span>
<span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="va">species</span><span class="op">:</span><span class="va">bill_depth_mm</span><span class="op">)</span></code></pre></div>
<pre><code>## select: dropped 4 variables (flipper_length_mm, body_mass_g, sex, year)</code></pre>
<pre><code>## # A tibble: 344 × 4
##   species island    bill_length_mm bill_depth_mm
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
## 1 Adelie  Torgersen           39.1          18.7
## 2 Adelie  Torgersen           39.5          17.4
## 3 Adelie  Torgersen           40.3          18  
## # … with 341 more rows</code></pre>
<p>Sometimes it is easier to remove the columns you don’t want.
You can do this by putting a <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> in front of the column name.</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#select everything but year and sex</span>
<span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span>, <span class="op">-</span><span class="va">sex</span><span class="op">)</span></code></pre></div>
<pre><code>## select: dropped 2 variables (sex, year)</code></pre>
<pre><code>## # A tibble: 344 × 6
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
## 1 Adelie  Torgersen           39.1          18.7               181        3750
## 2 Adelie  Torgersen           39.5          17.4               186        3800
## 3 Adelie  Torgersen           40.3          18                 195        3250
## # … with 341 more rows</code></pre>
<p>If there is a pattern to the column names that we want to select (or remove), there are some helper functions.
For example, to select columns that start with “bill”, we can use <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>.</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#select bill_length_mm &amp; bill_depth_mm" </span>
<span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"bill"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## select: dropped 6 variables (species, island, flipper_length_mm, body_mass_g, sex, …)</code></pre>
<pre><code>## # A tibble: 344 × 2
##   bill_length_mm bill_depth_mm
##            &lt;dbl&gt;         &lt;dbl&gt;
## 1           39.1          18.7
## 2           39.5          17.4
## 3           40.3          18  
## # … with 341 more rows</code></pre>
<p>Conversely, if we want to select all columns that end with “mm”, we can use <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>.
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> is more flexible and <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> is the most powerful of the helper functions, using regular expressions to identify the columns (see the regular expression tutorial).</p>
<p>Sometimes, you might want to select all the columns of a certain type.
For example, to select all the numeric columns we can use the <code>is.numeric</code> function inside <code><a href="https://rdrr.io/pkg/tidylog/man/select.html">select()</a></code> with the helper <code>where()</code>.</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="co"># No brackets on the function</span></code></pre></div>
<pre><code>## select: dropped 3 variables (species, island, sex)</code></pre>
<pre><code>## # A tibble: 344 × 5
##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
##            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;int&gt;
## 1           39.1          18.7               181        3750  2007
## 2           39.5          17.4               186        3800  2007
## 3           40.3          18                 195        3250  2007
## # … with 341 more rows</code></pre>
<p>Other <code>is.*</code> functions exist, for example, <code>is.character</code> for text, <code><a href="http://lubridate.tidyverse.org/reference/date_utils.html">lubridate::is.Date</a></code> for dates.</p>
<p>You can also select columns by number (1 being the first column), but this is generally a bad idea because it makes the code difficult to understand and if a new column is added, or the column order is changed, the code will break.</p>
<p>Which of these strategies works best is context dependent.</p>
</div>
</div>
<div id="renaming-columns-with-rename" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Renaming columns with <code>rename</code><a class="anchor" aria-label="anchor" href="#renaming-columns-with-rename"><i class="fas fa-link"></i></a>
</h2>
<p>You can use <code><a href="https://rdrr.io/pkg/tidylog/man/rename.html">rename()</a></code> to rename columns</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/rename.html">rename</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="va">species</span><span class="op">)</span></code></pre></div>
<pre><code>## rename: renamed one variable (Species)</code></pre>
<pre><code>## # A tibble: 344 × 8
##   Species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           39.1          18.7               181        3750 male  
## 2 Adelie  Torgersen           39.5          17.4               186        3800 female
## 3 Adelie  Torgersen           40.3          18                 195        3250 female
## # … with 341 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>The syntax is <code>new_name = current_name</code>.</p>
<p>You can also rename a column when selecting.
This is convenient if you are using <code><a href="https://rdrr.io/pkg/tidylog/man/select.html">select()</a></code> anyway.</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/select.html">select</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="va">species</span><span class="op">)</span></code></pre></div>
<pre><code>## select: renamed one variable (Species) and dropped 7 variables</code></pre>
<pre><code>## # A tibble: 344 × 1
##   Species
##   &lt;fct&gt;  
## 1 Adelie 
## 2 Adelie 
## 3 Adelie 
## # … with 341 more rows</code></pre>
</div>
<div id="moving-columns-with-relocate" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Moving columns with <code>relocate()</code><a class="anchor" aria-label="anchor" href="#moving-columns-with-relocate"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes it is useful to reorder the columns.
This is never necessary for data analysis or plotting, but can be needed when making a table for presentation.</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/relocate.html">relocate</a></span><span class="op">(</span><span class="va">island</span><span class="op">)</span></code></pre></div>
<pre><code>## relocate: columns reordered (island, species, bill_length_mm, bill_depth_mm, flipper_length_mm, …)</code></pre>
<pre><code>## # A tibble: 344 × 8
##   island    species bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;     &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Torgersen Adelie            39.1          18.7               181        3750 male  
## 2 Torgersen Adelie            39.5          17.4               186        3800 female
## 3 Torgersen Adelie            40.3          18                 195        3250 female
## # … with 341 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>The default is to move the named column first, the <code>.before</code> and <code>.after</code> arguments let you move the column into any position.</p>
</div>
<div id="filtering-rows-with-filter" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Filtering rows with <code>filter()</code><a class="anchor" aria-label="anchor" href="#filtering-rows-with-filter"><i class="fas fa-link"></i></a>
</h2>
<p>Filtering rows that meet some condition is a very common task.</p>
<p>For example, to filter rows of <code>penguins</code> that have a bill length greater than 40 mm, we can use</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span><span class="op">)</span></code></pre></div>
<pre><code>## filter: removed 102 rows (30%), 242 rows remaining</code></pre>
<pre><code>## # A tibble: 242 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           40.3          18                 195        3250 female
## 2 Adelie  Torgersen           42            20.2               190        4250 &lt;NA&gt;  
## 3 Adelie  Torgersen           41.1          17.6               182        3200 female
## # … with 239 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>This will filter out each row where the condition is <code>TRUE</code>.</p>
<p>The base R equivalent of this is</p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span><span class="op">[</span><span class="va">penguins</span><span class="op">$</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 244 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           40.3          18                 195        3250 female
## 2 &lt;NA&gt;    &lt;NA&gt;                NA            NA                  NA          NA &lt;NA&gt;  
## 3 Adelie  Torgersen           42            20.2               190        4250 &lt;NA&gt;  
## # … with 241 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>Generally, <code>filter</code> makes it easier to understand, especially with more complex criteria.</p>
<p>Other tests include</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> exactly equals. Often a bad idea to use with numeric data</li>
<li>
<code>near</code> safe function for testing equality of numeric data as it has a tolerance for rounding errors.</li>
</ul>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">2</span> <span class="co"># should be true, but rounding errors </span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">-</span> <span class="fl">2</span> <span class="co"># the difference</span></code></pre></div>
<pre><code>## [1] 4.440892e-16</code></pre>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># safe alternative</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">!=</a></code> not equal to</li>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">&lt;</a></code> less than</li>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">&lt;=</a></code> less than or equal to</li>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">&gt;</a></code> greater than</li>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">&gt;=</a></code> greater than or equal to</li>
<li>
<code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> for filtering by missing values.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/between.html">between()</a></code> for filtering values with a range</li>
<li>
<code><a href="https://rdrr.io/r/base/match.html">%in%</a></code> is used when you want to test if a value is in a vector</li>
</ul>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## filter: removed 124 rows (36%), 220 rows remaining</code></pre>
<pre><code>## # A tibble: 220 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           39.1          18.7               181        3750 male  
## 2 Adelie  Torgersen           39.5          17.4               186        3800 female
## 3 Adelie  Torgersen           40.3          18                 195        3250 female
## # … with 217 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#equivalent to </span>
<span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span> <span class="op">|</span> <span class="va">species</span> <span class="op">==</span> <span class="st">"Chinstrap"</span><span class="op">)</span> <span class="co"># with many alternatives, this gets long</span></code></pre></div>
<pre><code>## filter: removed 124 rows (36%), 220 rows remaining</code></pre>
<pre><code>## # A tibble: 220 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           39.1          18.7               181        3750 male  
## 2 Adelie  Torgersen           39.5          17.4               186        3800 female
## 3 Adelie  Torgersen           40.3          18                 195        3250 female
## # … with 217 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<div id="filtering-on-multiple-criteria" class="section level3" number="7.5.1">
<h3>
<span class="header-section-number">7.5.1</span> Filtering on multiple criteria<a class="anchor" aria-label="anchor" href="#filtering-on-multiple-criteria"><i class="fas fa-link"></i></a>
</h3>
<p>If we want to filter on multiple criteria, we need to decide whether we want all criteria to be <code>TRUE</code> (AND in Boolean logic), or for one or more to be <code>TRUE</code> (OR in Boolean logic).</p>
<p>If we want all criteria to be <code>TRUE</code>, we can separate them by a comma (or by an <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> if you want to be explicit).</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="va">bill_depth_mm</span> <span class="op">&gt;</span> <span class="fl">18</span><span class="op">)</span></code></pre></div>
<pre><code>## filter: removed 263 rows (76%), 81 rows remaining</code></pre>
<pre><code>## # A tibble: 81 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex  
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt;
## 1 Adelie  Torgersen           42            20.2               190        4250 &lt;NA&gt; 
## 2 Adelie  Torgersen           42.5          20.7               197        4500 male 
## 3 Adelie  Torgersen           46            21.5               194        4200 male 
## # … with 78 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>If we want rows where any of the criteria is <code>TRUE</code>, we can separate them by a <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code>.</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span> <span class="op">|</span> <span class="va">bill_depth_mm</span> <span class="op">&gt;</span> <span class="fl">18</span><span class="op">)</span></code></pre></div>
<pre><code>## filter: removed 53 rows (15%), 291 rows remaining</code></pre>
<pre><code>## # A tibble: 291 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           39.1          18.7               181        3750 male  
## 2 Adelie  Torgersen           40.3          18                 195        3250 female
## 3 Adelie  Torgersen           36.7          19.3               193        3450 female
## # … with 288 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>We can negate a criterion by putting <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> in front of it.
So to filter rows that do not have bills longer than 40 mm we can use</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span><span class="op">)</span></code></pre></div>
<pre><code>## filter: removed 244 rows (71%), 100 rows remaining</code></pre>
<pre><code>## # A tibble: 100 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           39.1          18.7               181        3750 male  
## 2 Adelie  Torgersen           39.5          17.4               186        3800 female
## 3 Adelie  Torgersen           36.7          19.3               193        3450 female
## # … with 97 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>Of course, in this example, we could also use <code><a href="https://rdrr.io/r/base/Comparison.html">&lt;=</a></code> as the test.</p>
</div>
<div id="common-errors" class="section level3" number="7.5.2">
<h3>
<span class="header-section-number">7.5.2</span> Common errors<a class="anchor" aria-label="anchor" href="#common-errors"><i class="fas fa-link"></i></a>
</h3>
<p>The commonest error is to use a single <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> rather than <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code>.
Only the latter is a test of equality.
If you do this, the error message is quite helpful.</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Chinstrap"</span><span class="op">)</span></code></pre></div>
<pre><code>## Error: Problem with `filter()` input `..1`.
## x Input `..1` is named.
## ℹ This usually means that you've used `=` instead of `==`.
## ℹ Did you mean `species == "Chinstrap"`?</code></pre>
<p>Another common error is to forget to quote any strings.</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="va">Chinstrap</span><span class="op">)</span></code></pre></div>
<pre><code>## Error: Problem with `filter()` input `..1`.
## ℹ Input `..1` is `species == Chinstrap`.
## x object 'Chinstrap' not found</code></pre>
</div>
</div>
<div id="slicing-the-data-with-slice" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Slicing the data with <code>slice()</code><a class="anchor" aria-label="anchor" href="#slicing-the-data-with-slice"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes it is useful to extract rows by row number.</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/slice.html">slice</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></code></pre></div>
<pre><code>## slice: removed 339 rows (99%), 5 rows remaining</code></pre>
<pre><code>## # A tibble: 5 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           40.3          18                 195        3250 female
## 2 Adelie  Torgersen           NA            NA                  NA          NA &lt;NA&gt;  
## 3 Adelie  Torgersen           36.7          19.3               193        3450 female
## 4 Adelie  Torgersen           39.3          20.6               190        3650 male  
## 5 Adelie  Torgersen           38.9          17.8               181        3625 female
## # … with 1 more variable: year &lt;int&gt;</code></pre>
<p>You can use negative numbers to remove rows.
Be careful using <code><a href="https://rdrr.io/pkg/tidylog/man/slice.html">slice()</a></code> as if the data change, different rows may be returned.</p>
</div>
<div id="distinct-rows-with-distinct" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Distinct rows with <code>distinct()</code><a class="anchor" aria-label="anchor" href="#distinct-rows-with-distinct"><i class="fas fa-link"></i></a>
</h2>
<p>If there are duplicates in the data, we can remove these with <code><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct()</a></code>.
<code><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct()</a></code> with no extra arguments will remove duplicate rows.</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## distinct: no rows removed</code></pre>
<pre><code>## # A tibble: 344 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           39.1          18.7               181        3750 male  
## 2 Adelie  Torgersen           39.5          17.4               186        3800 female
## 3 Adelie  Torgersen           40.3          18                 195        3250 female
## # … with 341 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>If we are only interested in some of the columns, we can supply the names of these columns.</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/distinct.html">distinct</a></span><span class="op">(</span><span class="va">island</span><span class="op">)</span></code></pre></div>
<pre><code>## distinct: removed 341 rows (99%), 3 rows remaining</code></pre>
<pre><code>## # A tibble: 3 × 1
##   island   
##   &lt;fct&gt;    
## 1 Torgersen
## 2 Biscoe   
## 3 Dream</code></pre>
<p>Other columns will be removed unless the argument <code>.keep_all = TRUE</code> is used.</p>
</div>
<div id="random-rows" class="section level2" number="7.8">
<h2>
<span class="header-section-number">7.8</span> Random rows<a class="anchor" aria-label="anchor" href="#random-rows"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes you want to sample rows at random from a data.frame.
This can be done with <code><a href="https://rdrr.io/pkg/tidylog/man/slice_sample.html">slice_sample()</a></code>.
This can either sample a constant <em>n</em> rows or constant fraction of the rows depending on whether the <code>n</code> or <code>prop</code> argument is used.</p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/slice_sample.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>## slice_sample: removed 334 rows (97%), 10 rows remaining</code></pre>
<pre><code>## # A tibble: 10 × 8
##    species   island   bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  
##    &lt;fct&gt;     &lt;fct&gt;             &lt;dbl&gt;         &lt;dbl&gt;            &lt;int&gt;       &lt;int&gt; &lt;fct&gt;
##  1 Gentoo    Biscoe             46.3          15.8              215        5050 male 
##  2 Adelie    Torgers…           39            17.1              191        3050 fema…
##  3 Adelie    Torgers…           39.7          18.4              190        3900 male 
##  4 Adelie    Torgers…           39.6          17.2              196        3550 fema…
##  5 Adelie    Torgers…           35.5          17.5              190        3700 fema…
##  6 Adelie    Torgers…           39.2          19.6              195        4675 male 
##  7 Adelie    Biscoe             39.6          17.7              186        3500 fema…
##  8 Adelie    Torgers…           35.2          15.9              186        3050 fema…
##  9 Adelie    Dream              36            17.9              190        3450 fema…
## 10 Chinstrap Dream              50.9          17.9              196        3675 fema…
## # … with 1 more variable: year &lt;int&gt;</code></pre>
</div>
<div id="mutating-and-adding-columns-with-mutate" class="section level2" number="7.9">
<h2>
<span class="header-section-number">7.9</span> Mutating and adding columns with <code>mutate</code><a class="anchor" aria-label="anchor" href="#mutating-and-adding-columns-with-mutate"><i class="fas fa-link"></i></a>
</h2>
<p>The function <code><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate()</a></code> can add an new column or replace an existing one.</p>
<p>To make a new column called <code>body_mass_kg</code> we can use</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate</a></span><span class="op">(</span>body_mass_kg <span class="op">=</span> <span class="va">body_mass_g</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<pre><code>## mutate: new variable 'body_mass_kg' (double) with 95 unique values and 1% NA</code></pre>
<pre><code>## # A tibble: 344 × 9
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Torgersen           39.1          18.7               181        3750 male  
## 2 Adelie  Torgersen           39.5          17.4               186        3800 female
## 3 Adelie  Torgersen           40.3          18                 195        3250 female
## # … with 341 more rows, and 2 more variables: year &lt;int&gt;, body_mass_kg &lt;dbl&gt;</code></pre>
<p>There are lots of functions that are useful to use with mutate.
Any function that returns either a single value or as many values as are in the data can be used.</p>
<p><code><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate()</a></code> is very useful when cleaning data.</p>
<ul>
<li>See text manipulation tutorial for cleaning text with the <code>stringr</code> package.</li>
<li>See date and time tutorial for cleaning dates and times with the <code>lubridate</code> package.</li>
</ul>
</div>
<div id="summarising-data-with-summarise" class="section level2" number="7.10">
<h2>
<span class="header-section-number">7.10</span> Summarising data with <code>summarise()</code><a class="anchor" aria-label="anchor" href="#summarising-data-with-summarise"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise()</a></code> lets us summarise data.
We can use it if we want to calculate a summary statistic of the data.
Remember to separate arguments with a comma.</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise</a></span><span class="op">(</span>
  flipper_len_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
  flipper_len_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## summarise: now one row and 2 columns, ungrouped</code></pre>
<pre><code>## # A tibble: 1 × 2
##   flipper_len_mean flipper_len_sd
##              &lt;dbl&gt;          &lt;dbl&gt;
## 1             201.           14.1</code></pre>
<p>Only the columns created in the <code><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise()</a></code> and any grouping columns (see below) will be kept.</p>
<div id="summarising-multiple-columns" class="section level3" number="7.10.1">
<h3>
<span class="header-section-number">7.10.1</span> Summarising multiple columns<a class="anchor" aria-label="anchor" href="#summarising-multiple-columns"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes you want to summarise multiple columns at the same time.
This can be done with the <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> helper function.
<code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> needs to be told which columns to process and what function or functions to use.</p>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt;
   <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## summarise: now one row and 2 columns, ungrouped</code></pre>
<pre><code>## # A tibble: 1 × 2
##   bill_length_mm bill_depth_mm
##            &lt;dbl&gt;         &lt;dbl&gt;
## 1           43.9          17.2</code></pre>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#using a list of functions</span>
<span class="va">penguins</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"bill"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="va">sd</span>, mean <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## summarise: now one row and 4 columns, ungrouped</code></pre>
<pre><code>## # A tibble: 1 × 4
##   bill_length_mm_sd bill_length_mm_mean bill_depth_mm_sd bill_depth_mm_mean
##               &lt;dbl&gt;               &lt;dbl&gt;            &lt;dbl&gt;              &lt;dbl&gt;
## 1              5.46                43.9             1.97               17.2</code></pre>
<p>You can also use <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> with <code><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate()</a></code> to mutate several columns at the same time.</p>
</div>
</div>
<div id="grouping-data-with-group_by" class="section level2" number="7.11">
<h2>
<span class="header-section-number">7.11</span> Grouping data with <code>group_by</code><a class="anchor" aria-label="anchor" href="#grouping-data-with-group_by"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by()</a></code> changes the way that many of the <code>dplyr</code> functions work.
Instead of working on the entire dataset, they now work on each group in the data</p>
<p>To find the mean flipper length for each species, we need to <code><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by()</a></code> species and then <code><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise()</a></code>.</p>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise</a></span><span class="op">(</span>mean_flipper_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## group_by: one grouping variable (species)</code></pre>
<pre><code>## summarise: now 3 rows and 2 columns, ungrouped</code></pre>
<pre><code>## # A tibble: 3 × 2
##   species   mean_flipper_length
##   &lt;fct&gt;                   &lt;dbl&gt;
## 1 Adelie                    NA 
## 2 Chinstrap                196.
## 3 Gentoo                    NA</code></pre>
<p>Grouped data can be ungrouped with <code><a href="https://rdrr.io/pkg/tidylog/man/ungroup.html">ungroup()</a></code>.
This can help prevent surprises!</p>
</div>
<div id="sorting-with-arrange" class="section level2" number="7.12">
<h2>
<span class="header-section-number">7.12</span> Sorting with <code>arrange()</code><a class="anchor" aria-label="anchor" href="#sorting-with-arrange"><i class="fas fa-link"></i></a>
</h2>
<p>To sort the data frame by one or more of the variables we can use <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>.</p>
<div class="sourceCode" id="cb377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 344 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Adelie  Dream               32.1          15.5               188        3050 female
## 2 Adelie  Dream               33.1          16.1               178        2900 female
## 3 Adelie  Torgersen           33.5          19                 190        3600 female
## # … with 341 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
<p>This will sort smallest first.
To reverse the sort order, use <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code></p>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">bill_length_mm</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 344 × 8
##   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   
##   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
## 1 Gentoo    Biscoe           59.6          17                 230        6050 male  
## 2 Chinstrap Dream            58            17.8               181        3700 female
## 3 Gentoo    Biscoe           55.9          17                 228        5600 male  
## # … with 341 more rows, and 1 more variable: year &lt;int&gt;</code></pre>
</div>
<div id="counting-rows-with-count-and-n" class="section level2" number="7.13">
<h2>
<span class="header-section-number">7.13</span> Counting rows with <code>count()</code> and <code>n()</code><a class="anchor" aria-label="anchor" href="#counting-rows-with-count-and-n"><i class="fas fa-link"></i></a>
</h2>
<p>The function <code>n</code> can count how many rows there are in the each group (or the entire data frame if it is not grouped).
It can be used with either <code><a href="https://rdrr.io/pkg/tidylog/man/mutate.html">mutate()</a></code> or <code><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise()</a></code>.</p>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## group_by: one grouping variable (species)</code></pre>
<pre><code>## summarise: now 3 rows and 2 columns, ungrouped</code></pre>
<pre><code>## # A tibble: 3 × 2
##   species       n
##   &lt;fct&gt;     &lt;int&gt;
## 1 Adelie      152
## 2 Chinstrap    68
## 3 Gentoo      124</code></pre>
<p>Or with <code><a href="https://rdrr.io/pkg/tidylog/man/count.html">count()</a></code></p>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/count.html">count</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span></code></pre></div>
<pre><code>## count: now 3 rows and 2 columns, ungrouped</code></pre>
<pre><code>## # A tibble: 3 × 2
##   species       n
##   &lt;fct&gt;     &lt;int&gt;
## 1 Adelie      152
## 2 Chinstrap    68
## 3 Gentoo      124</code></pre>
<p><code><a href="https://rdrr.io/pkg/tidylog/man/count.html">count()</a></code> is more concise, but <code><a href="https://rdrr.io/pkg/tidylog/man/group_by.html">group_by()</a></code> and <code><a href="https://rdrr.io/pkg/tidylog/man/summarise.html">summarise()</a></code> is useful when you need to calculate more variables (for example mean and standard deviation).</p>
</div>
<div id="common-problems" class="section level2" number="7.14">
<h2>
<span class="header-section-number">7.14</span> Common problems<a class="anchor" aria-label="anchor" href="#common-problems"><i class="fas fa-link"></i></a>
</h2>
<div id="non-standard-names" class="section level3" number="7.14.1">
<h3>
<span class="header-section-number">7.14.1</span> Non standard names<a class="anchor" aria-label="anchor" href="#non-standard-names"><i class="fas fa-link"></i></a>
</h3>
<p>Ideally column names should follow the standard rules for naming objects in R - UPPER and lower case letters, numbers, “.” and "_" with the first character being a letter (or a dot if you want an invisible object).
Sometimes when you import data, it has non-standard names with spaces or extra characters.
If you need to refer to a column name that doesn’t follow the rules, you need to enclose it with back-ticks.</p>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>`Region/Country` <span class="op">=</span> <span class="st">"Norway"</span>, value <span class="op">=</span> <span class="fl">42</span><span class="op">)</span>
<span class="va">df</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   `Region/Country` value
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 Norway              42</code></pre>
<div class="sourceCode" id="cb390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/tidylog/man/rename.html">rename</a></span><span class="op">(</span>region_country <span class="op">=</span> <span class="va">`Region/Country`</span><span class="op">)</span></code></pre></div>
<pre><code>## rename: renamed one variable (region_country)</code></pre>
<pre><code>## # A tibble: 1 × 2
##   region_country value
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 Norway            42</code></pre>
<p>It is sometimes best to rename these columns to make them easier to refer to.
<code>janitor::clean_names()</code> is very efficient for making easy-to-use names.</p>
</div>
</div>
<div id="resources" class="section level2" number="7.15">
<h2>
<span class="header-section-number">7.15</span> Resources<a class="anchor" aria-label="anchor" href="#resources"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://stat545.com/dplyr-intro.html">stat545</a></li>
<li>
<a href="https://r4ds.had.co.nz/">R for data science</a> (Online copy of book)</li>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf"><code>dplyr</code> cheatsheet</a></li>
</ul>
<div id="contributors-4" class="section level3 unnumbered contributors toc-ignore">
<h3>Contributors<a class="anchor" aria-label="anchor" href="#contributors-4"><i class="fas fa-link"></i></a>
</h3>
<p>Richard J. Telford</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tidying-data-with-tidyr.html"><span class="header-section-number">6</span> Tidying data with tidyr</a></div>
<div class="next"><a href="working-with-multiple-tables-in-dplyr.html"><span class="header-section-number">8</span> Working with multiple tables in dplyr</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#working-with-single-tables-in-dplyr"><span class="header-section-number">7</span> Working with single tables in dplyr</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-the-package"><span class="header-section-number">7.0.1</span> Load the package</a></li>
<li><a class="nav-link" href="#more-feedback-tidylog"><span class="header-section-number">7.0.2</span> More feedback tidylog</a></li>
</ul>
</li>
<li><a class="nav-link" href="#the-penguins-dataset"><span class="header-section-number">7.1</span> The penguins dataset</a></li>
<li>
<a class="nav-link" href="#selecting-columns-with-select"><span class="header-section-number">7.2</span> Selecting columns with select()</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#select-helpers"><span class="header-section-number">7.2.1</span> select() helpers</a></li></ul>
</li>
<li><a class="nav-link" href="#renaming-columns-with-rename"><span class="header-section-number">7.3</span> Renaming columns with rename</a></li>
<li><a class="nav-link" href="#moving-columns-with-relocate"><span class="header-section-number">7.4</span> Moving columns with relocate()</a></li>
<li>
<a class="nav-link" href="#filtering-rows-with-filter"><span class="header-section-number">7.5</span> Filtering rows with filter()</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#filtering-on-multiple-criteria"><span class="header-section-number">7.5.1</span> Filtering on multiple criteria</a></li>
<li><a class="nav-link" href="#common-errors"><span class="header-section-number">7.5.2</span> Common errors</a></li>
</ul>
</li>
<li><a class="nav-link" href="#slicing-the-data-with-slice"><span class="header-section-number">7.6</span> Slicing the data with slice()</a></li>
<li><a class="nav-link" href="#distinct-rows-with-distinct"><span class="header-section-number">7.7</span> Distinct rows with distinct()</a></li>
<li><a class="nav-link" href="#random-rows"><span class="header-section-number">7.8</span> Random rows</a></li>
<li><a class="nav-link" href="#mutating-and-adding-columns-with-mutate"><span class="header-section-number">7.9</span> Mutating and adding columns with mutate</a></li>
<li>
<a class="nav-link" href="#summarising-data-with-summarise"><span class="header-section-number">7.10</span> Summarising data with summarise()</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#summarising-multiple-columns"><span class="header-section-number">7.10.1</span> Summarising multiple columns</a></li></ul>
</li>
<li><a class="nav-link" href="#grouping-data-with-group_by"><span class="header-section-number">7.11</span> Grouping data with group_by</a></li>
<li><a class="nav-link" href="#sorting-with-arrange"><span class="header-section-number">7.12</span> Sorting with arrange()</a></li>
<li><a class="nav-link" href="#counting-rows-with-count-and-n"><span class="header-section-number">7.13</span> Counting rows with count() and n()</a></li>
<li>
<a class="nav-link" href="#common-problems"><span class="header-section-number">7.14</span> Common problems</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#non-standard-names"><span class="header-section-number">7.14.1</span> Non standard names</a></li></ul>
</li>
<li>
<a class="nav-link" href="#resources"><span class="header-section-number">7.15</span> Resources</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#contributors-4">Contributors</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Working in R</strong>" was written by Jonathan Soulé, Aud Halbritter and Richard J Telford. It was last built on 2021-08-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
